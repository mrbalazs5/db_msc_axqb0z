CREATE OR REPLACE TYPE KONYV AS OBJECT (
    CIM VARCHAR2(100),
    MEGJELENES INT
);

CREATE OR REPLACE TYPE IRO AS OBJECT (
    EREDETI_NEV VARCHAR2(30),
    IROI_ALNEV VARCHAR2(30),
    SZEV INT,
    MEMBER FUNCTION KOR RETURN INT
);

CREATE OR REPLACE TYPE BODY IRO IS
  MEMBER FUNCTION KOR RETURN INT IS
  BEGIN
    RETURN 2021 - SELF.SZEV;
  END;
END;

CREATE TABLE IROK OF IRO;

INSERT INTO IROK VALUES(IRO('Agatha Mary Clarissa Miller','Agatha Christie', 1890));
INSERT INTO IROK VALUES(IRO('Joanne Rowling','J. K. Rowling', 1965));
INSERT INTO IROK VALUES(IRO('Leiner Laura','Leiner Laura', 1985));

SELECT * FROM IROK;

SELECT I.EREDETI_NEV, I.IROI_ALNEV, I.SZEV, I.KOR() FROM IROK I;

CREATE TABLE KONYVEK (KID INT PRIMARY KEY, KONYV KONYV, IRO REF IRO);

INSERT INTO KONYVEK VALUES(1, KONYV('Harry Potter és a Titkok Kamrája', 2000), (SELECT REF(I) FROM IROK I WHERE I.IROI_ALNEV = 'J. K. Rowling'));
INSERT INTO KONYVEK VALUES(2, KONYV('Higgy nekem', 2001), (SELECT REF(I) FROM IROK I WHERE I.IROI_ALNEV = 'Leiner Laura'));
INSERT INTO KONYVEK VALUES(3, KONYV('Az Ackroyd-gyilkosság', 1974), (SELECT REF(I) FROM IROK I WHERE I.IROI_ALNEV = 'Agatha Christie'));
INSERT INTO KONYVEK VALUES(4, KONYV('Tíz kicsi néger', 1968), (SELECT REF(I) FROM IROK I WHERE I.IROI_ALNEV = 'Agatha Christie'));

SELECT K.KONYV.CIM, DEREF(K.IRO).IROI_ALNEV FROM KONYVEK K ORDER BY K.KONYV.CIM;

CREATE OR REPLACE TYPE KIADO AS OBJECT(
    NEV VARCHAR2(50),
    ALAPITAS INT
);

CREATE TYPE KIADOK AS TABLE OF KIADO;

ALTER TABLE KONYVEK ADD (KONYV_KIADOK KIADOK)NESTED TABLE KONYV_KIADOK STORE AS KKIADOK;

SELECT K.KONYV.CIM, K.KONYV_KIADOK FROM KONYVEK K;

UPDATE KONYVEK K SET K.KONYV_KIADOK = KIADOK(KIADO('Magvető', 1955), KIADO('Európa', 1981)) WHERE K.KONYV.CIM ='Az Ackroyd-gyilkosság';

SELECT * FROM TABLE(SELECT K.KONYV_KIADOK FROM KONYVEK K WHERE K.KONYV.CIM = 'Az Ackroyd-gyilkosság');